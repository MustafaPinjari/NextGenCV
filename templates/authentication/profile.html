{% extends 'layouts/authenticated.html' %}
{% load static %}

{% block title %}{{ user.get_full_name }} - Profile{% endblock %}

{% block extra_css %}
<style>
    /* Profile Header */
    .profile-header {
        position: relative;
        margin-bottom: var(--spacing-6);
    }
    
    .profile-cover {
        height: 200px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: var(--radius-xl);
        position: relative;
        overflow: hidden;
    }
    
    .profile-cover::after {
        content: '';
        position: absolute;
        inset: 0;
        background: url('data:image/svg+xml,<svg width="100" height="100" xmlns="http://www.w3.org/2000/svg"><defs><pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse"><path d="M 20 0 L 0 0 0 20" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="1"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
        opacity: 0.3;
    }
    
    .profile-cover-edit {
        position: absolute;
        top: var(--spacing-3);
        right: var(--spacing-3);
        z-index: 1;
    }
    
    .profile-info {
        background: var(--color-surface);
        border: 1px solid var(--color-border);
        border-radius: var(--radius-xl);
        padding: var(--spacing-5);
        margin-top: -60px;
        position: relative;
        z-index: 1;
    }
    
    .profile-main {
        display: flex;
        align-items: flex-start;
        gap: var(--spacing-4);
        margin-bottom: var(--spacing-4);
    }
    
    .profile-photo-container {
        position: relative;
    }
    
    .profile-photo {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        border: 4px solid var(--color-surface);
        background: var(--color-surface-elevated);
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        box-shadow: var(--shadow-lg);
    }
    
    .profile-photo img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    
    .profile-photo i {
        font-size: 3rem;
        color: var(--color-text-tertiary);
    }
    
    .profile-photo-edit {
        position: absolute;
        bottom: 0;
        right: 0;
        width: 36px;
        height: 36px;
        border-radius: 50%;
        background: var(--color-primary-solid);
        border: 3px solid var(--color-surface);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        cursor: pointer;
        transition: all var(--duration-fast) var(--easing-default);
    }
    
    .profile-photo-edit:hover {
        transform: scale(1.1);
        box-shadow: var(--glow-primary);
    }
    
    .profile-details {
        flex: 1;
    }
    
    .profile-name {
        font-size: var(--font-size-3xl);
        font-weight: var(--font-weight-bold);
        color: var(--color-text-primary);
        margin-bottom: var(--spacing-1);
    }
    
    .profile-title {
        font-size: var(--font-size-lg);
        color: var(--color-text-secondary);
        margin-bottom: var(--spacing-2);
    }
    
    .profile-meta {
        display: flex;
        flex-wrap: wrap;
        gap: var(--spacing-3);
        color: var(--color-text-secondary);
        font-size: var(--font-size-sm);
    }
    
    .profile-meta-item {
        display: flex;
        align-items: center;
        gap: var(--spacing-1);
    }
    
    .profile-actions {
        display: flex;
        gap: var(--spacing-2);
    }
    
    /* Stats Row */
    .profile-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: var(--spacing-3);
        margin-bottom: var(--spacing-6);
    }
    
    .stat-card {
        background: var(--color-surface);
        border: 1px solid var(--color-border);
        border-radius: var(--radius-lg);
        padding: var(--spacing-4);
        text-align: center;
        transition: all var(--duration-fast) var(--easing-default);
    }
    
    .stat-card:hover {
        border-color: var(--color-border-hover);
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
    }
    
    .stat-icon {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        background: rgba(0, 102, 255, 0.1);
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto var(--spacing-2);
        color: var(--color-primary-solid);
        font-size: var(--font-size-xl);
    }
    
    .stat-value {
        font-size: var(--font-size-3xl);
        font-weight: var(--font-weight-bold);
        color: var(--color-text-primary);
        margin-bottom: var(--spacing-1);
    }
    
    .stat-label {
        font-size: var(--font-size-sm);
        color: var(--color-text-secondary);
    }
    
    /* Tabs */
    .profile-tabs {
        background: var(--color-surface);
        border: 1px solid var(--color-border);
        border-radius: var(--radius-xl);
        padding: var(--spacing-3);
        margin-bottom: var(--spacing-4);
    }
    
    .tab-nav {
        display: flex;
        gap: var(--spacing-2);
        border-bottom: 1px solid var(--color-border);
        padding-bottom: var(--spacing-3);
    }
    
    .tab-link {
        padding: var(--spacing-2) var(--spacing-4);
        border-radius: var(--radius-md);
        color: var(--color-text-secondary);
        text-decoration: none;
        transition: all var(--duration-fast) var(--easing-default);
        position: relative;
    }
    
    .tab-link:hover {
        background: var(--color-surface-elevated);
        color: var(--color-text-primary);
    }
    
    .tab-link.active {
        color: var(--color-primary-solid);
        background: rgba(0, 102, 255, 0.1);
    }
    
    .tab-link.active::after {
        content: '';
        position: absolute;
        bottom: -13px;
        left: 50%;
        transform: translateX(-50%);
        width: 60%;
        height: 3px;
        background: var(--color-primary-solid);
        border-radius: 3px;
        box-shadow: var(--glow-primary);
    }
    
    .tab-content {
        padding: var(--spacing-4);
    }
    
    .tab-pane {
        display: none;
    }
    
    .tab-pane.active {
        display: block;
    }
    
    /* Overview Tab */
    .profile-bio {
        background: var(--color-surface-elevated);
        border: 1px solid var(--color-border);
        border-radius: var(--radius-lg);
        padding: var(--spacing-4);
        margin-bottom: var(--spacing-4);
    }
    
    .profile-bio h4 {
        color: var(--color-text-primary);
        margin-bottom: var(--spacing-2);
    }
    
    .profile-bio p {
        color: var(--color-text-secondary);
        line-height: var(--line-height-relaxed);
    }
    
    .profile-skills {
        background: var(--color-surface-elevated);
        border: 1px solid var(--color-border);
        border-radius: var(--radius-lg);
        padding: var(--spacing-4);
        margin-bottom: var(--spacing-4);
    }
    
    .profile-skills h4 {
        color: var(--color-text-primary);
        margin-bottom: var(--spacing-3);
    }
    
    .skill-tags {
        display: flex;
        flex-wrap: wrap;
        gap: var(--spacing-2);
    }
    
    .skill-tag {
        padding: var(--spacing-1) var(--spacing-3);
        background: var(--color-surface);
        border: 1px solid var(--color-border);
        border-radius: var(--radius-full);
        color: var(--color-text-primary);
        font-size: var(--font-size-sm);
        transition: all var(--duration-fast) var(--easing-default);
    }
    
    .skill-tag:hover {
        border-color: var(--color-primary-solid);
        background: rgba(0, 102, 255, 0.1);
        color: var(--color-primary-solid);
    }
    
    /* Activity Timeline */
    .activity-timeline {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    
    .activity-item {
        display: flex;
        gap: var(--spacing-3);
        padding: var(--spacing-3);
        border-radius: var(--radius-lg);
        transition: background var(--duration-fast) var(--easing-default);
    }
    
    .activity-item:hover {
        background: var(--color-surface-elevated);
    }
    
    .activity-icon {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: rgba(0, 102, 255, 0.1);
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--color-primary-solid);
        flex-shrink: 0;
    }
    
    .activity-content {
        flex: 1;
    }
    
    .activity-text {
        color: var(--color-text-primary);
        margin-bottom: var(--spacing-1);
    }
    
    .activity-time {
        font-size: var(--font-size-sm);
        color: var(--color-text-tertiary);
    }
    
    /* Resume Grid */
    .resume-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: var(--spacing-4);
    }
    
    .resume-card {
        background: var(--color-surface-elevated);
        border: 1px solid var(--color-border);
        border-radius: var(--radius-lg);
        padding: var(--spacing-4);
        transition: all var(--duration-fast) var(--easing-default);
        cursor: pointer;
    }
    
    .resume-card:hover {
        border-color: var(--color-primary-solid);
        transform: translateY(-4px);
        box-shadow: var(--glow-primary);
    }
    
    .resume-card-header {
        display: flex;
        justify-content: space-between;
        align-items: start;
        margin-bottom: var(--spacing-3);
    }
    
    .resume-card-title {
        font-weight: var(--font-weight-semibold);
        color: var(--color-text-primary);
        margin-bottom: var(--spacing-1);
    }
    
    .resume-card-score {
        padding: var(--spacing-1) var(--spacing-2);
        background: rgba(16, 185, 129, 0.1);
        border-radius: var(--radius-sm);
        color: var(--color-success);
        font-size: var(--font-size-sm);
        font-weight: var(--font-weight-semibold);
    }
    
    .resume-card-meta {
        font-size: var(--font-size-sm);
        color: var(--color-text-secondary);
    }
    
    @media (max-width: 768px) {
        .profile-main {
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        
        .profile-actions {
            width: 100%;
            flex-direction: column;
        }
        
        .tab-nav {
            overflow-x: auto;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Profile Header -->
<div class="profile-header">
    <div class="profile-cover">
        <button class="btn btn-ghost profile-cover-edit">
            <i class="bi bi-camera"></i> Edit Cover
        </button>
    </div>
    
    <div class="profile-info">
        <div class="profile-main">
            <div class="profile-photo-container">
                <div class="profile-photo">
                    {% if user.profile_photo %}
                    <img src="{{ user.profile_photo.url }}" alt="{{ user.get_full_name }}">
                    {% else %}
                    <i class="bi bi-person-circle"></i>
                    {% endif %}
                </div>
                <div class="profile-photo-edit">
                    <i class="bi bi-camera"></i>
                </div>
            </div>
            
            <div class="profile-details">
                <h1 class="profile-name">{{ user.get_full_name|default:"User Name" }}</h1>
                <p class="profile-title">{{ user.title|default:"Professional Title" }}</p>
                <div class="profile-meta">
                    <span class="profile-meta-item">
                        <i class="bi bi-envelope"></i>
                        {{ user.email }}
                    </span>
                    {% if user.location %}
                    <span class="profile-meta-item">
                        <i class="bi bi-geo-alt"></i>
                        {{ user.location }}
                    </span>
                    {% endif %}
                    <span class="profile-meta-item">
                        <i class="bi bi-calendar"></i>
                        Joined {{ user.date_joined|date:"F Y" }}
                    </span>
                </div>
            </div>
            
            <div class="profile-actions">
                <a href="{% url 'settings' %}" class="btn btn-primary">
                    <i class="bi bi-pencil"></i> Edit Profile
                </a>
                <button class="btn btn-outline">
                    <i class="bi bi-share"></i> Share
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Stats Row -->
<div class="profile-stats">
    <div class="stat-card">
        <div class="stat-icon">
            <i class="bi bi-file-text"></i>
        </div>
        <div class="stat-value">{{ resume_count|default:0 }}</div>
        <div class="stat-label">Resumes Created</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-icon" style="background: rgba(16, 185, 129, 0.1); color: var(--color-success);">
            <i class="bi bi-graph-up"></i>
        </div>
        <div class="stat-value">{{ average_score|default:0|floatformat:0 }}%</div>
        <div class="stat-label">Average ATS Score</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-icon" style="background: rgba(99, 102, 241, 0.1); color: var(--color-secondary);">
            <i class="bi bi-stars"></i>
        </div>
        <div class="stat-value">{{ improvements_count|default:0 }}</div>
        <div class="stat-label">Total Improvements</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-icon" style="background: rgba(245, 158, 11, 0.1); color: var(--color-warning);">
            <i class="bi bi-clock-history"></i>
        </div>
        <div class="stat-value">{{ days_active|default:0 }}</div>
        <div class="stat-label">Days Active</div>
    </div>
</div>

<!-- Tabs -->
<div class="profile-tabs">
    <nav class="tab-nav">
        <a href="#overview" class="tab-link active" data-tab="overview">
            <i class="bi bi-person"></i> Overview
        </a>
        <a href="#resumes" class="tab-link" data-tab="resumes">
            <i class="bi bi-file-text"></i> Resumes
        </a>
        <a href="#activity" class="tab-link" data-tab="activity">
            <i class="bi bi-activity"></i> Activity
        </a>
    </nav>
    
    <div class="tab-content">
        <!-- Overview Tab -->
        <div class="tab-pane active" id="overview-pane">
            <div class="profile-bio">
                <h4><i class="bi bi-person"></i> About</h4>
                <p>
                    {{ user.bio|default:"No bio added yet. Click 'Edit Profile' to add information about yourself." }}
                </p>
            </div>
            
            <div class="profile-skills">
                <h4><i class="bi bi-gear"></i> Skills</h4>
                <div class="skill-tags">
                    {% if user_skills %}
                        {% for skill in user_skills %}
                        <span class="skill-tag">{{ skill }}</span>
                        {% endfor %}
                    {% else %}
                        <span class="skill-tag">Python</span>
                        <span class="skill-tag">JavaScript</span>
                        <span class="skill-tag">React</span>
                        <span class="skill-tag">Django</span>
                        <span class="skill-tag">SQL</span>
                        <span class="skill-tag">Git</span>
                        <span class="skill-tag">AWS</span>
                        <span class="skill-tag">Docker</span>
                    {% endif %}
                </div>
            </div>
            
            <div class="profile-bio">
                <h4><i class="bi bi-clock-history"></i> Recent Activity</h4>
                <ul class="activity-timeline">
                    <li class="activity-item">
                        <div class="activity-icon">
                            <i class="bi bi-file-plus"></i>
                        </div>
                        <div class="activity-content">
                            <div class="activity-text">Created a new resume</div>
                            <div class="activity-time">2 hours ago</div>
                        </div>
                    </li>
                    <li class="activity-item">
                        <div class="activity-icon" style="background: rgba(16, 185, 129, 0.1); color: var(--color-success);">
                            <i class="bi bi-graph-up"></i>
                        </div>
                        <div class="activity-content">
                            <div class="activity-text">Improved ATS score to 85%</div>
                            <div class="activity-time">1 day ago</div>
                        </div>
                    </li>
                    <li class="activity-item">
                        <div class="activity-icon" style="background: rgba(99, 102, 241, 0.1); color: var(--color-secondary);">
                            <i class="bi bi-stars"></i>
                        </div>
                        <div class="activity-content">
                            <div class="activity-text">Optimized resume with AI suggestions</div>
                            <div class="activity-time">3 days ago</div>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
        
        <!-- Resumes Tab -->
        <div class="tab-pane" id="resumes-pane">
            <div class="resume-grid">
                {% if resumes %}
                    {% for resume in resumes %}
                    <div class="resume-card" onclick="window.location.href='{% url 'resume_detail' resume.id %}'">
                        <div class="resume-card-header">
                            <div>
                                <div class="resume-card-title">{{ resume.title }}</div>
                                <div class="resume-card-meta">
                                    <i class="bi bi-clock"></i> Updated {{ resume.updated_at|timesince }} ago
                                </div>
                            </div>
                            {% if resume.ats_score %}
                            <div class="resume-card-score">
                                {{ resume.ats_score|floatformat:0 }}%
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div style="grid-column: 1 / -1; text-align: center; padding: var(--spacing-8); color: var(--color-text-tertiary);">
                        <i class="bi bi-inbox" style="font-size: 4rem; margin-bottom: var(--spacing-3); opacity: 0.5;"></i>
                        <p>No resumes yet</p>
                        <a href="{% url 'resume_create' %}" class="btn btn-primary" style="margin-top: var(--spacing-2);">
                            <i class="bi bi-plus-circle"></i> Create Your First Resume
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
        
        <!-- Activity Tab -->
        <div class="tab-pane" id="activity-pane">
            <ul class="activity-timeline">
                <li class="activity-item">
                    <div class="activity-icon">
                        <i class="bi bi-file-plus"></i>
                    </div>
                    <div class="activity-content">
                        <div class="activity-text">Created resume "Software Engineer Resume"</div>
                        <div class="activity-time">2 hours ago</div>
                    </div>
                </li>
                <li class="activity-item">
                    <div class="activity-icon" style="background: rgba(16, 185, 129, 0.1); color: var(--color-success);">
                        <i class="bi bi-graph-up"></i>
                    </div>
                    <div class="activity-content">
                        <div class="activity-text">ATS score improved from 72% to 85%</div>
                        <div class="activity-time">1 day ago</div>
                    </div>
                </li>
                <li class="activity-item">
                    <div class="activity-icon" style="background: rgba(99, 102, 241, 0.1); color: var(--color-secondary);">
                        <i class="bi bi-stars"></i>
                    </div>
                    <div class="activity-content">
                        <div class="activity-text">Applied AI optimization to resume</div>
                        <div class="activity-time">3 days ago</div>
                    </div>
                </li>
                <li class="activity-item">
                    <div class="activity-icon" style="background: rgba(245, 158, 11, 0.1); color: var(--color-warning);">
                        <i class="bi bi-download"></i>
                    </div>
                    <div class="activity-content">
                        <div class="activity-text">Downloaded resume as PDF</div>
                        <div class="activity-time">5 days ago</div>
                    </div>
                </li>
                <li class="activity-item">
                    <div class="activity-icon">
                        <i class="bi bi-pencil"></i>
                    </div>
                    <div class="activity-content">
                        <div class="activity-text">Updated work experience section</div>
                        <div class="activity-time">1 week ago</div>
                    </div>
                </li>
                <li class="activity-item">
                    <div class="activity-icon">
                        <i class="bi bi-upload"></i>
                    </div>
                    <div class="activity-content">
                        <div class="activity-text">Uploaded resume PDF for analysis</div>
                        <div class="activity-time">2 weeks ago</div>
                    </div>
                </li>
            </ul>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Tab switching
    const tabLinks = document.querySelectorAll('.tab-link');
    const tabPanes = document.querySelectorAll('.tab-pane');
    
    tabLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            
            // Update active tab link
            tabLinks.forEach(l => l.classList.remove('active'));
            this.classList.add('active');
            
            // Show corresponding pane
            const tabId = this.dataset.tab + '-pane';
            tabPanes.forEach(pane => {
                pane.classList.remove('active');
                if (pane.id === tabId) {
                    pane.classList.add('active');
                }
            });
            
            // Update URL hash
            window.location.hash = this.dataset.tab;
        });
    });
    
    // Handle initial hash
    if (window.location.hash) {
        const hash = window.location.hash.substring(1);
        const link = document.querySelector(`[data-tab="${hash}"]`);
        if (link) {
            link.click();
        }
    }
</script>
{% endblock %}
