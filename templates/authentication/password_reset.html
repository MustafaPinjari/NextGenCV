{% extends 'layouts/public.html' %}

{% block title %}Reset Password - NextGenCV{% endblock %}

{% block content %}
<div class="auth-page">
    <div class="auth-container">
        <!-- Auth Card -->
        <div class="auth-card">
            <!-- Logo and Welcome -->
            <div class="auth-header">
                <div class="auth-logo">
                    <i class="bi bi-shield-lock"></i>
                </div>
                <h1 class="auth-title">Reset your password</h1>
                <p class="auth-subtitle">Enter your email and we'll send you a reset link</p>
            </div>

            <!-- Password Reset Form -->
            <form method="post" class="auth-form" id="resetForm" novalidate>
                {% csrf_token %}
                
                {% if form.errors %}
                    <div class="alert alert--error" role="alert">
                        <div class="alert__icon">
                            <i class="bi bi-x-circle"></i>
                        </div>
                        <div class="alert__content">
                            {% for field, errors in form.errors.items %}
                                {% for error in errors %}
                                    {{ error }}
                                {% endfor %}
                            {% endfor %}
                        </div>
                    </div>
                {% endif %}
                
                <!-- Email Field -->
                <div class="form-group" id="emailGroup">
                    <input 
                        type="email" 
                        name="email" 
                        id="id_email" 
                        class="form-input" 
                        placeholder=" "
                        value="{{ form.email.value|default:'' }}"
                        required
                        aria-describedby="email-error"
                    >
                    <label for="id_email" class="form-label">Email Address</label>
                    <div class="form-error" id="email-error" style="display: none;">
                        Please enter a valid email address
                    </div>
                </div>
                
                <!-- Submit Button -->
                <button type="submit" class="btn btn--primary btn--block" id="submitBtn">
                    Send Reset Link
                </button>
            </form>
            
            <!-- Back to Login Link -->
            <div class="auth-footer">
                <p class="auth-footer__text">
                    Remember your password? 
                    <a href="{% url 'login' %}" class="auth-link auth-link--primary">Back to login</a>
                </p>
            </div>
        </div>
        
        <!-- Success State (Hidden by default) -->
        <div class="auth-card auth-success" id="successCard" style="display: none;">
            <div class="auth-header">
                <div class="auth-logo auth-logo--success">
                    <i class="bi bi-check-circle"></i>
                </div>
                <h1 class="auth-title">Check your email</h1>
                <p class="auth-subtitle">
                    We've sent a password reset link to <strong id="emailDisplay"></strong>
                </p>
            </div>
            
            <div class="success-content">
                <div class="success-instructions">
                    <h3 class="success-heading">What's next?</h3>
                    <ol class="success-list">
                        <li>Check your email inbox (and spam folder)</li>
                        <li>Click the reset link in the email</li>
                        <li>Create a new password</li>
                        <li>Sign in with your new password</li>
                    </ol>
                </div>
                
                <div class="success-actions">
                    <p class="success-text">Didn't receive the email?</p>
                    <button type="button" class="btn btn--outline btn--block" id="resendBtn">
                        Resend Email
                    </button>
                </div>
            </div>
            
            <div class="auth-footer">
                <p class="auth-footer__text">
                    <a href="{% url 'login' %}" class="auth-link auth-link--primary">Back to login</a>
                </p>
            </div>
        </div>
    </div>
</div>

<style>
/* Auth Page Styles */
.auth-page {
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: var(--spacing-4);
    background: var(--color-base-bg);
}

.auth-container {
    width: 100%;
    max-width: 480px;
}

.auth-card {
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-xl);
    padding: var(--spacing-6);
    box-shadow: var(--shadow-lg);
}

.auth-success {
    animation: fadeIn 350ms var(--easing-default);
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.auth-header {
    text-align: center;
    margin-bottom: var(--spacing-6);
}

.auth-logo {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 64px;
    height: 64px;
    background: linear-gradient(135deg, #0066ff 0%, #00ccff 100%);
    border-radius: var(--radius-lg);
    margin-bottom: var(--spacing-3);
    box-shadow: var(--glow-primary);
}

.auth-logo--success {
    background: linear-gradient(135deg, #10b981 0%, #34d399 100%);
    box-shadow: var(--glow-success);
}

.auth-logo i {
    font-size: 2rem;
    color: white;
}

.auth-title {
    font-size: var(--font-size-3xl);
    font-weight: var(--font-weight-bold);
    color: var(--color-text-primary);
    margin-bottom: var(--spacing-2);
    letter-spacing: var(--letter-spacing-tight);
}

.auth-subtitle {
    font-size: var(--font-size-base);
    color: var(--color-text-secondary);
    line-height: var(--line-height-relaxed);
}

.auth-subtitle strong {
    color: var(--color-text-primary);
    font-weight: var(--font-weight-medium);
}

.auth-form {
    margin-bottom: var(--spacing-4);
}

.form-group {
    position: relative;
    margin-bottom: var(--spacing-4);
}

.auth-footer {
    text-align: center;
    padding-top: var(--spacing-4);
    border-top: 1px solid var(--color-border);
}

.auth-footer__text {
    font-size: var(--font-size-sm);
    color: var(--color-text-secondary);
}

.auth-link {
    font-size: var(--font-size-sm);
    color: var(--color-text-secondary);
    text-decoration: none;
    transition: color var(--duration-fast) var(--easing-default);
}

.auth-link:hover {
    color: var(--color-text-primary);
}

.auth-link--primary {
    color: var(--color-primary-solid);
    font-weight: var(--font-weight-medium);
}

.auth-link--primary:hover {
    text-decoration: underline;
}

/* Success State Styles */
.success-content {
    margin-bottom: var(--spacing-4);
}

.success-instructions {
    background: var(--color-surface-elevated);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: var(--spacing-4);
    margin-bottom: var(--spacing-4);
}

.success-heading {
    font-size: var(--font-size-lg);
    font-weight: var(--font-weight-semibold);
    color: var(--color-text-primary);
    margin-bottom: var(--spacing-3);
}

.success-list {
    list-style: none;
    counter-reset: step-counter;
    padding: 0;
}

.success-list li {
    counter-increment: step-counter;
    position: relative;
    padding-left: var(--spacing-6);
    margin-bottom: var(--spacing-2);
    color: var(--color-text-secondary);
    line-height: var(--line-height-relaxed);
}

.success-list li:last-child {
    margin-bottom: 0;
}

.success-list li::before {
    content: counter(step-counter);
    position: absolute;
    left: 0;
    top: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 2rem;
    height: 2rem;
    background: var(--color-primary-solid);
    color: white;
    border-radius: 50%;
    font-size: var(--font-size-sm);
    font-weight: var(--font-weight-semibold);
}

.success-actions {
    text-align: center;
}

.success-text {
    font-size: var(--font-size-sm);
    color: var(--color-text-secondary);
    margin-bottom: var(--spacing-2);
}

/* Responsive */
@media (max-width: 640px) {
    .auth-page {
        padding: var(--spacing-2);
    }
    
    .auth-card {
        padding: var(--spacing-4);
    }
    
    .auth-title {
        font-size: var(--font-size-2xl);
    }
}
</style>

<script>
// Form validation and submission
const form = document.getElementById('resetForm');
const emailGroup = document.getElementById('emailGroup');
const emailInput = document.querySelector('[name="email"]');
const emailError = document.getElementById('email-error');
const submitBtn = document.getElementById('submitBtn');
const successCard = document.getElementById('successCard');
const emailDisplay = document.getElementById('emailDisplay');
const resendBtn = document.getElementById('resendBtn');

if (form) {
    form.addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Validate email
        const email = emailInput.value.trim();
        if (!email || !isValidEmail(email)) {
            emailGroup.classList.add('form-input-error');
            emailError.style.display = 'block';
            return;
        }
        
        // Remove error state
        emailGroup.classList.remove('form-input-error');
        emailError.style.display = 'none';
        
        // Show loading state
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<i class="bi bi-hourglass-split"></i> Sending...';
        
        // Simulate API call (replace with actual form submission)
        setTimeout(() => {
            // Hide form card
            form.closest('.auth-card').style.display = 'none';
            
            // Show success card
            emailDisplay.textContent = email;
            successCard.style.display = 'block';
            
            // Reset button state
            submitBtn.disabled = false;
            submitBtn.innerHTML = 'Send Reset Link';
        }, 1500);
    });
    
    // Remove error state on input
    emailInput.addEventListener('input', function() {
        emailGroup.classList.remove('form-input-error');
        emailError.style.display = 'none';
    });
}

// Resend email functionality
if (resendBtn) {
    resendBtn.addEventListener('click', function() {
        this.disabled = true;
        this.innerHTML = '<i class="bi bi-hourglass-split"></i> Sending...';
        
        // Simulate resend (replace with actual API call)
        setTimeout(() => {
            this.disabled = false;
            this.innerHTML = 'Resend Email';
            
            // Show success feedback
            const alert = document.createElement('div');
            alert.className = 'alert alert--success';
            alert.style.marginBottom = 'var(--spacing-4)';
            alert.innerHTML = `
                <div class="alert__icon">
                    <i class="bi bi-check-circle"></i>
                </div>
                <div class="alert__content">Email sent successfully!</div>
            `;
            
            successCard.querySelector('.success-content').insertBefore(
                alert,
                successCard.querySelector('.success-instructions')
            );
            
            // Remove alert after 3 seconds
            setTimeout(() => {
                alert.style.animation = 'slideOut 250ms ease-out forwards';
                setTimeout(() => alert.remove(), 250);
            }, 3000);
        }, 1500);
    });
}

// Email validation helper
function isValidEmail(email) {
    const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return re.test(email);
}

// Animation for slide out
const style = document.createElement('style');
style.textContent = `
    @keyframes slideOut {
        from {
            opacity: 1;
            transform: translateX(0);
        }
        to {
            opacity: 0;
            transform: translateX(20px);
        }
    }
`;
document.head.appendChild(style);
</script>
{% endblock %}
