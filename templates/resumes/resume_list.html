{% extends 'layouts/authenticated.html' %}

{% block title %}My Resumes - NextGenCV{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="page-header">
    <div class="page-header__content">
        <div class="page-header__title-section">
            <h1 class="page-header__title">My Resumes</h1>
            <p class="page-header__subtitle">Manage and optimize your professional resumes</p>
        </div>
        <div class="page-header__actions">
            <a href="{% url 'resume_create' %}" class="btn btn-gradient">
                <i class="bi bi-plus-circle"></i>
                <span>Create New Resume</span>
            </a>
        </div>
    </div>
    
    <!-- Search and Filter Bar -->
    <div class="page-header__toolbar">
        <div class="search-bar">
            <i class="bi bi-search search-bar__icon"></i>
            <input 
                type="text" 
                class="search-bar__input" 
                placeholder="Search resumes by title..."
                aria-label="Search resumes"
                id="resumeSearch"
            >
        </div>
        <div class="filter-group">
            <select class="filter-select" aria-label="Sort resumes" id="sortFilter">
                <option value="date">Sort by: Date Modified</option>
                <option value="name">Sort by: Name</option>
                <option value="template">Sort by: Template</option>
            </select>
        </div>
    </div>
</div>

{% if resumes %}
    <!-- Resume Grid -->
    <div class="resume-grid" id="resumeGrid">
        {% for resume in resumes %}
        <div class="resume-card card-elevated card-interactive" data-resume-title="{{ resume.title|lower }}" data-resume-date="{{ resume.updated_at|date:'Y-m-d' }}" data-resume-template="{{ resume.template }}">
            <!-- Resume Preview Thumbnail -->
            <div class="resume-card__preview">
                <div class="resume-card__preview-placeholder">
                    <i class="bi bi-file-earmark-text"></i>
                </div>
                <!-- Template Badge -->
                <div class="resume-card__badge badge badge-primary">
                    {{ resume.template|title }}
                </div>
            </div>
            
            <!-- Resume Info -->
            <div class="resume-card__content">
                <h3 class="resume-card__title">{{ resume.title }}</h3>
                <div class="resume-card__meta">
                    <span class="resume-card__meta-item">
                        <i class="bi bi-clock"></i>
                        <span>{{ resume.updated_at|date:"M d, Y" }}</span>
                    </span>
                </div>
            </div>
            
            <!-- Resume Actions (shown on hover) -->
            <div class="resume-card__actions">
                <div class="resume-card__actions-row">
                    <a href="{% url 'resume_detail' resume.id %}" class="btn btn-sm btn-ghost" title="View Resume" aria-label="View {{ resume.title }}">
                        <i class="bi bi-eye"></i>
                        <span>View</span>
                    </a>
                    <a href="{% url 'resume_update' resume.id %}" class="btn btn-sm btn-primary" title="Edit Resume" aria-label="Edit {{ resume.title }}">
                        <i class="bi bi-pencil"></i>
                        <span>Edit</span>
                    </a>
                </div>
                <div class="resume-card__actions-row">
                    <a href="{% url 'resume_duplicate' resume.id %}" class="btn btn-sm btn-ghost" title="Duplicate Resume" aria-label="Duplicate {{ resume.title }}">
                        <i class="bi bi-files"></i>
                        <span>Duplicate</span>
                    </a>
                    <a href="{% url 'resume_export' resume.id %}" class="btn btn-sm btn-ghost" title="Download Resume" aria-label="Download {{ resume.title }}">
                        <i class="bi bi-download"></i>
                        <span>Download</span>
                    </a>
                </div>
                <div class="resume-card__actions-row">
                    <a href="{% url 'resume_delete' resume.id %}" class="btn btn-sm btn-outline" title="Delete Resume" aria-label="Delete {{ resume.title }}" style="border-color: var(--color-error); color: var(--color-error);">
                        <i class="bi bi-trash"></i>
                        <span>Delete</span>
                    </a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    
    <!-- Pagination (if needed in future) -->
    {% if is_paginated %}
    <div class="pagination-container">
        <nav class="pagination" role="navigation" aria-label="Resume pagination">
            {% if page_obj.has_previous %}
                <a href="?page=1" class="pagination-item" aria-label="First page">
                    <i class="bi bi-chevron-double-left"></i>
                </a>
                <a href="?page={{ page_obj.previous_page_number }}" class="pagination-item" aria-label="Previous page">
                    <i class="bi bi-chevron-left"></i>
                </a>
            {% else %}
                <button class="pagination-item" disabled aria-label="First page">
                    <i class="bi bi-chevron-double-left"></i>
                </button>
                <button class="pagination-item" disabled aria-label="Previous page">
                    <i class="bi bi-chevron-left"></i>
                </button>
            {% endif %}
            
            <span class="pagination-info">
                Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
            </span>
            
            {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}" class="pagination-item" aria-label="Next page">
                    <i class="bi bi-chevron-right"></i>
                </a>
                <a href="?page={{ page_obj.paginator.num_pages }}" class="pagination-item" aria-label="Last page">
                    <i class="bi bi-chevron-double-right"></i>
                </a>
            {% else %}
                <button class="pagination-item" disabled aria-label="Next page">
                    <i class="bi bi-chevron-right"></i>
                </button>
                <button class="pagination-item" disabled aria-label="Last page">
                    <i class="bi bi-chevron-double-right"></i>
                </button>
            {% endif %}
        </nav>
    </div>
    {% endif %}
    
{% else %}
    <!-- Empty State -->
    <div class="empty-state">
        <div class="empty-state-icon">
            <i class="bi bi-file-earmark-text"></i>
        </div>
        <h2 class="empty-state-title">No resumes yet</h2>
        <p class="empty-state-description">
            Create your first ATS-optimized resume to get started with your job search journey.
        </p>
        <div class="empty-state-action">
            <a href="{% url 'resume_create' %}" class="btn btn-gradient btn-lg">
                <i class="bi bi-plus-circle"></i>
                <span>Create Your First Resume</span>
            </a>
        </div>
    </div>
{% endif %}
{% endblock %}

{% block extra_js %}
<script>
    // Search functionality
    const searchInput = document.getElementById('resumeSearch');
    const sortFilter = document.getElementById('sortFilter');
    const resumeGrid = document.getElementById('resumeGrid');
    const resumeCards = resumeGrid ? Array.from(resumeGrid.querySelectorAll('.resume-card')) : [];
    
    if (searchInput && resumeCards.length > 0) {
        searchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            
            resumeCards.forEach(card => {
                const title = card.dataset.resumeTitle;
                const matches = title.includes(searchTerm);
                card.style.display = matches ? '' : 'none';
            });
        });
    }
    
    // Sort functionality
    if (sortFilter && resumeCards.length > 0) {
        sortFilter.addEventListener('change', (e) => {
            const sortBy = e.target.value;
            
            const sortedCards = [...resumeCards].sort((a, b) => {
                if (sortBy === 'name') {
                    return a.dataset.resumeTitle.localeCompare(b.dataset.resumeTitle);
                } else if (sortBy === 'date') {
                    return new Date(b.dataset.resumeDate) - new Date(a.dataset.resumeDate);
                } else if (sortBy === 'template') {
                    return a.dataset.resumeTemplate.localeCompare(b.dataset.resumeTemplate);
                }
                return 0;
            });
            
            // Re-append cards in sorted order
            sortedCards.forEach(card => resumeGrid.appendChild(card));
        });
    }
</script>
{% endblock %}
